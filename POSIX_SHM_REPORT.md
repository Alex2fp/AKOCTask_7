# Клиент/сервер на POSIX shared memory

## Структура взаимодействия

- Разделяемый объект `"/akoctask7_shm"` создаётся через `shm_open` и отображается в память обоими процессами.
- В сегменте хранится структура `SharedState` с флагами готовности клиента/сервера, признаком наличия нового числа и самим значением.
- Клиент генерирует случайные числа в диапазоне 0–99 и помещает их в сегмент, когда `has_value == 0`.
- Сервер опрашивает разделяемую память и выводит числа на экран, сбрасывая `has_value` после чтения.

## Вариант корректного завершения

1. И клиент, и сервер устанавливают обработчики сигналов `SIGINT` и `SIGTERM`.
2. При получении сигнала (например, пользователь нажал `Ctrl+C` в одном из терминалов) локальная переменная `stop_requested` становится равной 1, а процесс выставляет в разделяемой памяти флаг `terminate = 1`.
3. Оба процесса в основном цикле регулярно проверяют `terminate`. Как только один из процессов инициировал завершение, второй мгновенно увидит флаг и выйдет из цикла.
4. При завершении каждый процесс сбрасывает свой флаг готовности (`client_ready`/`server_ready`), снимает отображение `munmap`, закрывает дескриптор и пытается удалить объект `shm_unlink`. Если второй процесс уже успел удалить объект, вызов завершится с `ENOENT`, что считается нормой.

Таким образом, при попытке завершить любой из процессов оба приложения корректно завершаются, а сегмент разделяемой памяти гарантированно удаляется.
